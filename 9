Perfect â€” I can see your code clearly now and tell you the exact line numbers to modify.

Hereâ€™s where each addition goes based on your screenshot (where checkApprovalCodeElementsSectionTemplate starts around line 3070):

â¸»

ğŸŸ¢ Step 1 â€” Add the multi-stage guard

ğŸ“ Insert right after line 3074, immediately following your findStage line.

const isMulti = stages?.length > 1;

// In multi-stage, skip sections whose mapped stage does NOT require GAC
if (isMulti && !findStage?.isGenerateApprovalCode) {
  if (template?.templates?.length) {
    flag = this.checkApprovalCodeElementsSectionTemplate(template, stages, flag);
  }
  continue; // go to next template
}


â¸»

ğŸŸ¢ Step 2 â€” Wrap the screen-level fallback

Your fallback block (starting right after line 3079 â€” this.checkApprovalCodeElementsSingleTemplate(template, customFlag);)
should now look like this:

// Single-stage order independence only
if (!isMulti && customFlag.status) {
  const screenFlag = this.checkApprovalCodeElementsSingleTemplate(
    obj,
    { status: false, stageName: [] }
  );
  if (!screenFlag.status) {
    // Found GAC elsewhere on the same screen â†’ treat as valid
    customFlag.status = false;
  }
}

Thatâ€™s the same place where your current screenFlag code sits â€” just wrap it with the !isMulti condition.

â¸»

âœ… Summary

Step	Action	Approx. Line	Purpose
1	Insert multi-stage guard	After 3074	Skip non-GAC stages in multi-stage
2	Wrap fallback with !isMulti	Around 3079	Keep fallback only for single-stage

After this, re-test:
	â€¢	Single-stage â†’ passes if GAC exists anywhere.
	â€¢	Multi-stage â†’ fails only for stages that checked â€œGenerate Approval Codeâ€ but donâ€™t have the component.